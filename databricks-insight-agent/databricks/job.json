{
  "name": "Databricks Insight Agent - Security Analysis",
  "email_notifications": {
    "on_start": [],
    "on_success": [],
    "on_failure": ["security@company.com", "admin@company.com"]
  },
  "timeout_seconds": 3600,
  "max_concurrent_runs": 1,
  "tasks": [
    {
      "task_key": "analysis_task",
      "description": "Run comprehensive security and network analysis",
      "python_wheel_task": {
        "package_name": "databricks_insight_agent",
        "entry_point": "main",
        "parameters": [
          "--mode", "once",
          "--hours", "24"
        ]
      },
      "libraries": [
        {
          "pypi": {
            "package": "databricks-sdk>=0.20.0"
          }
        },
        {
          "pypi": {
            "package": "dspy-ai>=2.4.0"
          }
        },
        {
          "pypi": {
            "package": "mlflow>=2.10.0"
          }
        },
        {
          "pypi": {
            "package": "pandas>=2.0.0"
          }
        },
        {
          "pypi": {
            "package": "pyspark>=3.5.0"
          }
        },
        {
          "pypi": {
            "package": "openai>=1.0.0"
          }
        },
        {
          "pypi": {
            "package": "structlog>=23.0.0"
          }
        },
        {
          "pypi": {
            "package": "pydantic>=2.0.0"
          }
        }
      ],
      "new_cluster": {
        "spark_version": "14.3.x-scala2.12",
        "node_type_id": "Standard_DS3_v2",
        "num_workers": 2,
        "spark_env_vars": {
          "OPENAI_API_KEY": "{{secrets/insight-agent/openai_api_key}}",
          "DATABRICKS_TOKEN": "{{secrets/insight-agent/databricks_token}}",
          "SMTP_USER": "{{secrets/insight-agent/smtp_user}}",
          "SMTP_PASS": "{{secrets/insight-agent/smtp_pass}}"
        },
        "spark_conf": {
          "spark.databricks.delta.preview.enabled": "true",
          "spark.sql.adaptive.enabled": "true"
        },
        "init_scripts": [
          {
            "dbfs": {
              "destination": "dbfs:/databricks/init/insight-agent/init.sh"
            }
          }
        ]
      },
      "timeout_seconds": 3600
    }
  ],
  "parameters": [
    {
      "name": "hours_back",
      "default": "24"
    }
  ],
  "environments": [
    {
      "environment_key": "insight-agent-env",
      "spec": {
        "dependencies": [
          "databricks-sdk>=0.20.0",
          "dspy-ai>=2.4.0",
          "mlflow>=2.10.0",
          "pandas>=2.0.0",
          "pyspark>=3.5.0",
          "openai>=1.0.0",
          "structlog>=23.0.0",
          "pydantic>=2.0.0",
          "fastapi>=0.104.0",
          "uvicorn>=0.24.0"
        ],
        "environment_version": "1"
      }
    }
  ],
  "tags": {
    "team": "security",
    "project": "insight-agent",
    "environment": "production"
  }
}