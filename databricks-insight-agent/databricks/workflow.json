{
  "name": "Databricks Insight Agent - Enterprise Monitoring Workflow",
  "email_notifications": {
    "on_start": [],
    "on_success": ["data-team@company.com"],
    "on_failure": ["security@company.com", "devops@company.com"]
  },
  "timeout_seconds": 7200,
  "max_concurrent_runs": 1,
  "tasks": [
    {
      "task_key": "data_ingestion",
      "description": "Ingest data from Databricks system tables",
      "python_wheel_task": {
        "package_name": "databricks_insight_agent",
        "entry_point": "data_ingestion",
        "parameters": ["--hours", "24"]
      },
      "libraries": [
        {"pypi": {"package": "databricks-sdk>=0.20.0"}},
        {"pypi": {"package": "pandas>=2.0.0"}}
      ],
      "new_cluster": {
        "spark_version": "14.3.x-scala2.12",
        "node_type_id": "Standard_DS3_v2",
        "num_workers": 1,
        "spark_env_vars": {
          "DATABRICKS_TOKEN": "{{secrets/insight-agent/databricks_token}}"
        }
      },
      "timeout_seconds": 1800
    },
    {
      "task_key": "network_analysis",
      "description": "Analyze network patterns and connectivity",
      "depends_on": [{"task_key": "data_ingestion"}],
      "python_wheel_task": {
        "package_name": "databricks_insight_agent",
        "entry_point": "network_analysis",
        "parameters": []
      },
      "libraries": [
        {"pypi": {"package": "dspy-ai>=2.4.0"}},
        {"pypi": {"package": "openai>=1.0.0"}}
      ],
      "new_cluster": {
        "spark_version": "14.3.x-scala2.12",
        "node_type_id": "Standard_DS3_v2",
        "num_workers": 1,
        "spark_env_vars": {
          "OPENAI_API_KEY": "{{secrets/insight-agent/openai_api_key}}"
        }
      },
      "timeout_seconds": 1800
    },
    {
      "task_key": "security_analysis",
      "description": "Analyze security threats and compliance",
      "depends_on": [{"task_key": "data_ingestion"}],
      "python_wheel_task": {
        "package_name": "databricks_insight_agent",
        "entry_point": "security_analysis",
        "parameters": []
      },
      "libraries": [
        {"pypi": {"package": "dspy-ai>=2.4.0"}},
        {"pypi": {"package": "openai>=1.0.0"}}
      ],
      "new_cluster": {
        "spark_version": "14.3.x-scala2.12",
        "node_type_id": "Standard_DS3_v2",
        "num_workers": 1,
        "spark_env_vars": {
          "OPENAI_API_KEY": "{{secrets/insight-agent/openai_api_key}}"
        }
      },
      "timeout_seconds": 1800
    },
    {
      "task_key": "evaluation",
      "description": "Evaluate agent performance and score insights",
      "depends_on": [
        {"task_key": "network_analysis"},
        {"task_key": "security_analysis"}
      ],
      "python_wheel_task": {
        "package_name": "databricks_insight_agent",
        "entry_point": "evaluation",
        "parameters": []
      },
      "libraries": [
        {"pypi": {"package": "dspy-ai>=2.4.0"}},
        {"pypi": {"package": "openai>=1.0.0"}}
      ],
      "new_cluster": {
        "spark_version": "14.3.x-scala2.12",
        "node_type_id": "Standard_DS3_v2",
        "num_workers": 1,
        "spark_env_vars": {
          "OPENAI_API_KEY": "{{secrets/insight-agent/openai_api_key}}"
        }
      },
      "timeout_seconds": 900
    },
    {
      "task_key": "reporting",
      "description": "Generate reports and send alerts",
      "depends_on": [{"task_key": "evaluation"}],
      "python_wheel_task": {
        "package_name": "databricks_insight_agent",
        "entry_point": "reporting",
        "parameters": ["--type", "full"]
      },
      "libraries": [
        {"pypi": {"package": "pandas>=2.0.0"}}
      ],
      "new_cluster": {
        "spark_version": "14.3.x-scala2.12",
        "node_type_id": "Standard_DS3_v2",
        "num_workers": 1,
        "spark_env_vars": {
          "SMTP_USER": "{{secrets/insight-agent/smtp_user}}",
          "SMTP_PASS": "{{secrets/insight-agent/smtp_pass}}"
        }
      },
      "timeout_seconds": 900
    }
  ],
  "parameters": [
    {
      "name": "hours_back",
      "default": "24",
      "description": "Number of hours of historical data to analyze"
    },
    {
      "name": "alert_threshold",
      "default": "HIGH",
      "description": "Threat level threshold for alerts"
    }
  ],
  "environments": [
    {
      "environment_key": "insight-agent-env",
      "spec": {
        "dependencies": [
          "databricks-sdk>=0.20.0",
          "dspy-ai>=2.4.0",
          "mlflow>=2.10.0",
          "pandas>=2.0.0",
          "pyspark>=3.5.0",
          "openai>=1.0.0",
          "structlog>=23.0.0",
          "pydantic>=2.0.0"
        ],
        "environment_version": "1"
      }
    }
  ],
  "tags": {
    "team": "security",
    "project": "insight-agent",
    "environment": "production",
    "workflow": "enterprise-monitoring"
  },
  "trigger": {
    "cron": {
      "expression": "0 */6 * * *",
      "timezone_id": "UTC"
    }
  }
}